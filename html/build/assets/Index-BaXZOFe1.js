import{V as p}from"./VisitorLayout-BEoXhik2.js";import{i as s,q as y,c as g,o as h,a as r,t as M,b as v,d as b}from"./app-DMTjTVQZ.js";import{C as I,_ as B}from"./ChatForm-Bq93ZhMW.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VisitorBreadcrumbs-D33gSTMY.js";const x={class:"container"},E={class:"card"},S={class:"card-header"},V={key:0,class:"loading-indicator"},j={class:"card-footer"},k=Object.assign({layout:p},{__name:"Index",props:{auth:Object,sender:Object,initialMessages:Array,roomId:String,room:Object},setup(c){const d=c,t=s(d.initialMessages),n=s(d.roomId),i=s(null),a=s(!1),u=s(1),l=s(!1),f=e=>{axios.post("/messages",{...e,roomId:n.value}).then(o=>{console.log(o.data)})},m=e=>{a.value||l.value||(a.value=!0,axios.get("/messages",{params:{page:e,roomId:n.value}}).then(o=>{a.value=!1,o.data.length>0?(t.value=[...o.data,...t.value],u.value++):(l.value=!0,console.log("Tous les messages chargés"))}))},_=()=>{if(l.value||a.value)return;i.value.scrollTop===0&&(console.log("Scroll en haut détecté, chargement des anciens messages..."),m(u.value+1))};return y(()=>{m(1);try{Echo.channel(`chat-room.${n.value}`).subscribed(function(){console.log("subscribed To Channel")}).listenToAll(function(){console.log("listening to channel")}).listen("ChatMessageSent",e=>{t.value.push({message:e.message.message,sender_id:e.sender.id,sender:e.sender})})}catch(e){console.error("Error setting up Echo listener:",e)}}),(e,o)=>(h(),g("div",x,[r("div",E,[r("div",S,"Chats Privés ( "+M(c.room.agence.raison_sociale)+")",1),r("div",{class:"card-body",ref_key:"chatBody",ref:i,onScroll:_},[v(I,{messages:t.value,sender:c.sender},null,8,["messages","sender"]),a.value?(h(),g("div",V,"Chargement des messages...")):b("",!0)],544),r("div",j,[v(B,{onMessagesent:f,sender:e.$props.sender,"room-id":n.value},null,8,["sender","room-id"])])])]))}}),L=C(k,[["__scopeId","data-v-f40c25f6"]]);export{L as default};
