import{V as p}from"./VisitorLayout-BJlFWEJK.js";import{i as s,q as y,c as m,o as h,a as r,t as M,b as v,d as b}from"./app-B4jHxjza.js";import{C as I,_ as B}from"./ChatForm-DfEJ-HOZ.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VisitorBreadcrumbs-BibWL0Dz.js";const S={class:"container"},x={class:"card"},E={class:"card-header"},V={key:0,class:"loading-indicator"},k={class:"card-footer"},T=Object.assign({layout:p},{__name:"Index",props:{auth:Object,sender:Object,initialMessages:Array,roomId:String},setup(c){const d=c,n=s(d.initialMessages),a=s(d.roomId),i=s(null),o=s(!1),u=s(1),l=s(!1),f=e=>{axios.post("/messages",{...e,roomId:a.value}).then(t=>{console.log(t.data)})},g=e=>{o.value||l.value||(o.value=!0,axios.get("/messages",{params:{page:e,roomId:a.value}}).then(t=>{o.value=!1,t.data.length>0?(n.value=[...t.data,...n.value],u.value++):(l.value=!0,console.log("Tous les messages chargés"))}))},_=()=>{if(l.value||o.value)return;i.value.scrollTop===0&&(console.log("Scroll en haut détecté, chargement des anciens messages..."),g(u.value+1))};return y(()=>{g(1);try{Echo.channel(`chat-room.${a.value}`).subscribed(function(){console.log("subscribed To Channel")}).listenToAll(function(){console.log("listening to channel")}).listen("ChatMessageSent",e=>{n.value.push({message:e.message.message,sender_id:e.sender.id,sender:e.sender})})}catch(e){console.error("Error setting up Echo listener:",e)}}),(e,t)=>(h(),m("div",S,[r("div",x,[r("div",E,"Chats Privés (Salle: "+M(a.value)+")",1),r("div",{class:"card-body",ref_key:"chatBody",ref:i,onScroll:_},[v(I,{messages:n.value,sender:c.sender},null,8,["messages","sender"]),o.value?(h(),m("div",V,"Chargement des messages...")):b("",!0)],544),r("div",k,[v(B,{onMessagesent:f,sender:e.$props.sender,"room-id":a.value},null,8,["sender","room-id"])])])]))}}),L=C(T,[["__scopeId","data-v-fab3dacd"]]);export{L as default};
