import{C as y,_ as M}from"./ChatForm-DfEJ-HOZ.js";import{A as b}from"./AgenceLayout-Dbb7xDjt.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{i as a,k as B,q as C,c as m,o as h,a as l,t as S,b as v,d as x}from"./app-B4jHxjza.js";import"./VisitorBreadcrumbs-BibWL0Dz.js";const E={class:"container"},k={class:"card"},A={class:"card-header"},T={key:0,class:"loading-indicator"},j={class:"card-footer"},N=Object.assign({layout:b},{__name:"Index",props:{auth:Object,sender:Object,initialMessages:Array,roomId:String},setup(_){const r=_,n=a(r.initialMessages),s=a(r.roomId),d=a(null),o=a(!1),i=a(1),c=a(!1),u=B(()=>r.sender);console.log("roomId:",s.value),console.log("sender:",u.value);const p=e=>{axios.post("/agence/messages",{...e,roomId:s.value}).then(t=>{console.log(t.data)})},g=e=>{o.value||c.value||(o.value=!0,axios.get("/agence/messages",{params:{page:e,roomId:s.value}}).then(t=>{o.value=!1,t.data.length>0?(n.value=[...t.data,...n.value],i.value++):(c.value=!0,console.log("Tous les messages chargés"))}))},f=()=>{if(c.value||o.value)return;d.value.scrollTop===0&&(console.log("Scroll en haut détecté, chargement des anciens messages..."),g(i.value+1))};return C(()=>{g(1);try{Echo.channel(`chat-room.${s.value}`).subscribed(function(){console.log("subscribed To Channel")}).listenToAll(function(){console.log("listening to channel")}).listen("ChatMessageSent",e=>{n.value.push({message:e.message.message,sender_id:e.sender.id,sender:e.sender})})}catch(e){console.error("Error setting up Echo listener:",e)}}),(e,t)=>(h(),m("div",E,[l("div",k,[l("div",A,"Chats Privés (Salle: "+S(s.value)+")",1),l("div",{class:"card-body",ref_key:"chatBody",ref:d,onScroll:f},[v(y,{messages:n.value,sender:e.$props.sender},null,8,["messages","sender"]),o.value?(h(),m("div",T,"Chargement des messages...")):x("",!0)],544),l("div",j,[v(M,{onMessagesent:p,sender:u.value,"room-id":s.value},null,8,["sender","room-id"])])])]))}}),q=I(N,[["__scopeId","data-v-94e69bc3"]]);export{q as default};
