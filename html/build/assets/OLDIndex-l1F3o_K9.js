import{V as _}from"./VisitorLayout-BJlFWEJK.js";import{i as a,q as M,c as i,o as u,a as r,b as g,d as y}from"./app-B4jHxjza.js";import{C as B,_ as x}from"./ChatForm-DfEJ-HOZ.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VisitorBreadcrumbs-BibWL0Dz.js";const E={class:"container"},I={class:"card"},b={key:0,class:"loading-indicator"},O={class:"card-footer"},S=Object.assign({layout:_},{__name:"OLDIndex",props:{auth:Object,visiteur:Object,initialMessages:Array,roomId:String},setup(m){const l=m,o=a(l.initialMessages),h=a(l.roomId),c=a(null),t=a(!1),d=a(1),n=a(!1),v=e=>{o.value.push(e),axios.post("/messages",e).then(s=>{console.log(s.data)})},p=e=>{t.value||n.value||(t.value=!0,axios.get("/messages",{params:{page:e}}).then(s=>{t.value=!1,s.data.length>0?(o.value=[...s.data,...o.value],d.value++):(n.value=!0,console.log("Tous les messages chargés"))}))},f=()=>{if(n.value||t.value)return;c.value.scrollTop===0&&(console.log("Scroll en haut détecté, chargement des anciens messages..."),p(d.value+1))};return M(()=>{try{Echo.channel("chat-room").listen("ChatMessageSent",e=>{console.log("Message reçu:",e),o.value.push({message:e.message.message,sender_id:e.sender.id,sender:e.sender,isNew:!0})})}catch(e){console.error("Error setting up Echo listener:",e)}}),(e,s)=>(u(),i("div",E,[r("div",I,[s[0]||(s[0]=r("div",{class:"card-header"},"Chats",-1)),r("div",{class:"card-body",ref_key:"chatBody",ref:c,onScroll:f},[g(B,{messages:o.value},null,8,["messages"]),t.value?(u(),i("div",b,"Chargement des messages...")):y("",!0)],544),r("div",O,[g(x,{onMessagesent:v,visiteur:e.$props.auth.visiteur,"room-id":h.value},null,8,["visiteur","room-id"])])])]))}}),D=C(S,[["__scopeId","data-v-3da2d02f"]]);export{D as default};
